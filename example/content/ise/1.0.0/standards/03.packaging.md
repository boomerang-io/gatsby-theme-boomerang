---
title: Helm Charts
index: 3
---

# Developing Helm Charts

The following are the standards, best practices, and accelerators for teams building out helm charts and content for the IBM Automation and Boomerang platforms.

Helm is the best way to find, share, and use software built for Kubernetes. Read the helm documentation and best practices

[Helm Documentation](https://docs.helm.sh/)

## Common Helper Methods

We have packaged a series of common helper methods as a helm chart that can be set as a dependency, importing all of the template methods. This is based on the same design principles as ICP Content teams [Shared Configurable Helpers (SCH)](http://icp-content-playbook.rch.stglabs.ibm.com/shared-configurable-helpers/)

### Design

Most all charts have a `templates/_helpers.tpl` file, and maybe some additional helper .tpl files. In most have some common template definitions such as `"name"` and `"fullname"` for example. These template definitions are many times modified for a specific product chart and are not consistent across charts.

By utilizing [helm subcharts ](https://docs.helm.sh/chart_template_guide/#subcharts-and-global-values) we can take advantage of the fact that all template (tpl) files become globally shared, thus if we have a common subchart with helper tpl files, all of the defined template methods are available across the parent chart and any other subchart. We can then version and lifecycle the helper methods to ensure that they are consistent across charts.

Additionally it allows the power of community development to contribute to the helpers.

### Implementation

To utilize this chart you need to add the following to your `requirements.yaml`

```
dependencies:
  - name: bmrg-common
    repository: "@boomerang-charts"
    version: ~0.1.3
    alias: bmrgcommon
```

_Note:_ Ensure you have added the `boomerang-charts` helm repo as part of your local developer set up

### Available Methods

When using the methods, keep in mind the trimming of white space using `{{-`

| Method                 | Description                                                                                                                             | Example Usage                                                                                                                              |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| `bmrg.labels.standard` | This will generate all the labels used in a resources spec block of match labels and metadata labels                                    | `{{ include "bmrg.labels.standard" (dict "context" . "platform" $platform "product" $product "tier" $tier "component" $k ) | nindent 6 }}` |
| `bmrg.labels.chart`    | This will generate labels for the top metadata and should conside with the recommended helm labels                                      | `{{ include "bmrg.labels.chart" (dict "context" $ "tier" $tier "component" $k ) | nindent 6 }}`                                            |
| `bmrg.core.services`   | If you need to loop through and create linkage to the Core platform services, such as in a configmap to be passed to your microservices | `{{- include "bmrg.core.services" $ | indent 4 }}`                                                                                         |
| `bmrg.name.prefix`     | Name prefix. Will default to the chart name unless a name prefix is supplied on install                                                 |                                                                                                                                            |
| `bmrg.name`            | Create a name of a resource by merging `bmrg.name.prefix` with variables for full name                                                  | `'{{ include "bmrg.name" (dict "context" $ "tier" $tier "component" $k ) }}`                                                               |
| `bmrg.util.unique`     | A unique 6 character random number                                                                                                      |                                                                                                                                            |
| `bmrg.util.time`       | Uses the `$.Release.Time` global variable and removes certain string content                                                            |

## Checklist

| Focus                  | Standard Description                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Chart Structure        | As per helm chart standards                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Chart Name             | As per helm chart standards _AND_<br>All Boomerang platform charts are to be prefixed with `bmrg-` _AND_<br>All IBM Automation platform charts are to be prefixed with `iap-` _AND_<br>All charts must have the required extension as follows;<ul><li>`-dev`, the chart is for development or trial use</li><li>`-demo` the chart is a sample or demo</li><li>`No extension`. Charts that are ready for use and can be used for multiple purposes</li></ul> |
| Chart Version          | Charts must be versioned using SemVer 2 conventions                                                                                                                                                                                                                                                                                                                                                                                                         |
| App Version            | This is set to the version of the platform or the version of the application set                                                                                                                                                                                                                                                                                                                                                                            |
| Labels and Annotations | Helm defines a set of best practices regarding the creation of [labels and annotations](labels and annotations).                                                                                                                                                                                                                                                                                                                                            |
| Ingresses              | Ingress should only be enabled for those applications and services receiving external requests AND have some level of authentication implemented.                                                                                                                                                                                                                                                                                                           |
| Readiness Probe        | All deployments should implement a readiness probe of `/health` that determines when the deployment is ready to take load                                                                                                                                                                                                                                                                                                                                   |

## Values Metadata

One of the ICP specific content files is the `values-metadata.yaml`. This is **recommended** for all charts. The elements and attributes inside this file can be found at the [ICP Knowledge Center](https://www.ibm.com/support/knowledgecenter/en/SSBS6K_3.1.1/app_center/values_metadata.html)

## Available Default Parameters

If the chart is following the platform design, the following parameters will be passed in by default to the configmaps and secrets and available for use.

### Apps

| Property Key              | Description                                                                                              | Example Value                                                     |
| ------------------------- | -------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------- |
| `PORT`                    | A userful parameter to use to start your app on                                                          | `3000`                                                            |
| `APP_ROOT`                | The context to serve the content from in your application                                                | `/`                                                               |
| `NEW_RELIC_APP_NAME`      | The is a property that can be fed in as part of the newrelic javascript file to report back to New Relic |                                                                   |
| `NEW_RELIC_LICENSE_KEY`   | The is a property that can be fed in as part of the newrelic javascript file to report back to New Relic |                                                                   |
| `BASE_ENV_URL`            | The root url to the platform for the environment                                                         | `https://rtp1.cloud.boomerangplatform.net/dev`                    |
| `BASE_APPS_ENV_URL`       | The url to the platform apps for the environment                                                         | `https://rtp1.cloud.boomerangplatform.net/dev/apps`               |
| `BASE_SERVICE_ENV_URL`    | The url to the platform services for the environment                                                     | `https://rtp1.cloud.boomerangplatform.net/dev/services`           |
| `PRODUCT_ENV_URL`         | The root url to the product for the environment                                                          | `https://rtp1.cloud.boomerangplatform.net/dev/<product>`          |
| `PRODUCT_APPS_ENV_URL`    | The url to the product apps for the environment                                                          | `https://rtp1.cloud.boomerangplatform.net/dev/<product>/apps`     |
| `PRODUCT_SERVICE_ENV_URL` | The url to the product services for the environment                                                      | `https://rtp1.cloud.boomerangplatform.net/dev/<product>/services` |
| `CORE_ACCESS_TOKEN`       | The Access Token to access the core services                                                             |                                                                   |
| `CORE_AUTH_URL`           | The URL for the auth service from core                                                                   |                                                                   |
| `CORE_AUDIT_URL`          | The URL for the audit service from core                                                                  |                                                                   |

### Services

| Property Key                                                | Description                                                                                                                                              | Example Value                                                         |
| ----------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------- |
| `server.port`                                               | A userful parameter to use to start your service on                                                                                                      | 8080                                                                  |
| `core.proxy.host`                                           | Can be fed into the proxy library or used custom in your service to route requests through a forward proxy when the service is running in a private VLAN |                                                                       |
| `core.proxy.port`                                           | Can be fed into the proxy library or used custom in your service to route requests through a forward proxy when the service is running in a private VLAN |                                                                       |
| `logging.level.org.springframework.web.client.RestTemplate` | The url to the platform apps for the environment                                                                                                         | `https://rtp1.cloud.boomerangplatform.net/dev/<product>/services`     |
| <service_name>.service.host                                 | The internal DNS name for the service                                                                                                                    | `iap-acc-services-dashboard`                                          |
| <service_name>.service.root                                 | The external DNS url for the service                                                                                                                     | `https://rtp1.cloud.boomerangplatform.net/dev/acc/services/dashboard` |

_Parameters used automatically if New Relic is enabled_

The following properties will be visible in the configmap but will be used automatically if New Relic is injected into the service to report out.

| Property Key                        |
| ----------------------------------- |
| `newrelic.config.common.proxy_host` |
| `newrelic.config.common.proxy_port` |

## References

The following are great resources for further content

- ICP Content Playbook: [Developing Helm Charts](http://icp-content-playbook.rch.stglabs.ibm.com/developing-charts/)
-
